export const getGeneratePDF = async ({
  jsPDF,
  thSarabunFont,
  event,
  moment,
  docNo,
  description,
  subject,
}) => {
  const doc = new jsPDF({
    orientation: "portrait",
    unit: "mm",
    format: "A4",
  });
  doc.addFileToVFS("THSarabun.ttf", thSarabunFont);
  doc.addFont("THSarabun.ttf", "THSarabun", "normal");
  doc.setFont("THSarabun");
  doc.setFontSize(16);

  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();
  const marginLeft = 25;
  const marginRight = 25;
  const contentWidth = pageWidth - marginLeft - marginRight;

const docNumber = `‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: DA-${moment().format("YYYYMMDD")}-${event.extendedProps._id.slice(-5)}`;

  doc.setFontSize(12);

  // üîÅ ‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πâ‡∏Å‡∏•‡∏≤‡∏á‡∏Å‡∏£‡∏≠‡∏ö
  doc.text(docNumber, 182.5, 8, { align: "center" }); // X = ‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Å‡∏£‡∏≠‡∏ö, Y = ‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á

  // üî≤ ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö
  doc.setDrawColor(155);
  doc.setLineWidth(0.2);
  doc.rect(160, 3, 45, 8); // X, Y, Width, Height

  const timeText = event.extendedProps.time
    ? `‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${event.extendedProps.time} `
    : "";

  const siteCompany = event.extendedProps.company
    ? `${event.extendedProps.company} `
    : `‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ${event.extendedProps.site} `;

  const logo = "logo-light-2.png";
  const logoProps = doc.getImageProperties(logo);
  const logoWidth = 42; // ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πà‡∏ô
  const logoHeight = (logoProps.height / logoProps.width) * logoWidth;
  doc.addImage(logo, "PNG", 15, 3, logoWidth, logoHeight); // X=20, Y=12

  doc.setFontSize(20);
  doc.text("‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏î‡∏π ‡∏≠‡∏≠‡∏• ‡∏≠‡∏≤‡∏Ñ‡∏¥‡πÄ‡∏ó‡∏Ñ ‡πÅ‡∏≠‡∏ô‡∏î‡πå ‡πÄ‡∏≠‡πá‡∏ô‡∏à‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡∏¥‡πà‡∏á ‡∏à‡∏≥‡∏Å‡∏±‡∏î", 110, 20, {
    align: "center",
  });

  doc.setFontSize(14);
  doc.text("DO ALL ARCHITECT AND ENGINEERING CO.,LTD.", 110, 27, {
    align: "center",
  });

  doc.setFontSize(12);
  doc.text(
    "68/155 ‡∏´‡∏°‡∏π‡πà 3 ‡∏ñ‡∏ô‡∏ô‡∏ä‡∏±‡∏¢‡∏û‡∏§‡∏Å‡∏©‡πå ‡∏ï‡∏≥‡∏ö‡∏•‡∏Ñ‡∏•‡∏≠‡∏á‡∏û‡∏£‡∏∞‡∏≠‡∏∏‡∏î‡∏° ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏õ‡∏≤‡∏Å‡πÄ‡∏Å‡∏£‡πá‡∏î ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ 11120",
    110,
    34,
    { align: "center" }
  );

  doc.text("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: " + moment().format("DD-MM-YYYY"), 190, 44, {
    align: "right",
  });
  doc.text("‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: " + event.extendedProps.docNo, 18, 45, {
    align: "left",
  });

  // üî≤ ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö
  doc.setDrawColor(155);
  doc.setLineWidth(0.2);
  doc.rect(15, 40, 65, 7); // X, Y, Width, Height

  doc.line(15, 48, 195, 48);

  doc.setFontSize(16);
  doc.text(
    `‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ${subject}`,
    105,
    58,
    { align: "center" }
  );

  const start = moment(event.start).format("DD-MM-YYYY");
  const end = moment(event.end).format("DD-MM-YYYY");
  const descriptionLines = (description || "").split("\n");
  const lines = [
    "",
    `‡πÄ‡∏£‡∏µ‡∏¢‡∏ô  ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ${event.extendedProps.site}`,
    "",
    `        ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏î‡∏π ‡∏≠‡∏≠‡∏• ‡∏≠‡∏≤‡∏Ñ‡∏¥‡πÄ‡∏ó‡∏Ñ ‡πÅ‡∏≠‡∏ô‡∏î‡πå ‡πÄ‡∏≠‡πá‡∏ô‡∏à‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡∏¥‡πà‡∏á ‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πâ‡∏ß‡∏≤‡∏á‡πÉ‡∏à‡∏à‡∏≤‡∏Å ${siteCompany} `,
    `‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ${subject} ‡πÉ‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${start} ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${end}`,
    "",
    `        ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏î‡∏π ‡∏≠‡∏≠‡∏• ‡∏≠‡∏≤‡∏Ñ‡∏¥‡πÄ‡∏ó‡∏Ñ ‡πÅ‡∏≠‡∏ô‡∏î‡πå ‡πÄ‡∏≠‡πá‡∏ô‡∏à‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡∏¥‡πà‡∏á ‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡∏Ç‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ó‡πà‡∏≤‡∏ô‡∏ó‡∏£‡∏≤‡∏ö‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤ ${event.title} ‡∏£‡∏∞‡∏ö‡∏ö ${event.extendedProps.system}`,
    `‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${event.extendedProps.time} ‡∏ã‡∏∂‡πà‡∏á‡∏ó‡∏≤‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø ‡∏°‡∏µ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ`,
    "",
    ...descriptionLines.map((line) => `        ${line}`), // ‚úÖ ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á
    "",
    "        ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏Ø ‡πÉ‡∏Ñ‡∏£‡πà‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠ ‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ó‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏≤‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß ‡∏ó‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö",
    "‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏°‡∏µ‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡∏´‡∏≤‡∏Å‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà",
    "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏î‡∏π ‡∏≠‡∏≠‡∏• ‡∏≠‡∏≤‡∏Ñ‡∏¥‡πÄ‡∏ó‡∏Ñ ‡πÅ‡∏≠‡∏ô‡∏î‡πå ‡πÄ‡∏≠‡πá‡∏ô‡∏à‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡∏¥‡πà‡∏á ‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡∏î‡πâ‡∏ß‡∏¢ ‡∏à‡∏±‡∏Å‡∏Ç‡∏≠‡∏ö‡∏û‡∏£‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏¥‡πà‡∏á ",
  ];

  doc.setFontSize(14);
  let y = 68;
  lines.forEach((line) => {
    doc.text(line, 25, y); // ‚úÖ X=25 ‡πÉ‡∏´‡πâ‡∏´‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏ö‡∏ã‡πâ‡∏≤‡∏¢
    y += 8;
  });

  // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
  const footerY = y + 10;
  doc.setFontSize(14);
  doc.text("‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏∑‡∏≠", pageWidth - marginRight, footerY, {
    align: "right",
  });

  // ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡πâ‡∏≤‡∏¢
  const sigWidth = 28;
  const sigHeight = (logoProps.height / logoProps.width) * sigWidth;
  doc.addImage(
    logo,
    "PNG",
    pageWidth - marginRight - sigWidth,
    footerY + 5,
    sigWidth,
    sigHeight
  );

  // ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠
  const boxY = footerY + sigHeight + 15;
  const boxHeight = 40;
  const boxSpacing = 5;
  const boxWidth = (contentWidth - boxSpacing) / 2;

  // ‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  doc.setDrawColor(0);
  // doc.setLineWidth(0.5);
  doc.rect(marginLeft, boxY, boxWidth, boxHeight);
  doc.setFontSize(12);
  doc.text(
    `‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÉ‡∏ô‡∏ô‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ${event.extendedProps.site}`,
    marginLeft + 5,
    boxY + 8
  );
  doc.setFontSize(11);
  doc.text("‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠", marginLeft + 5, boxY + 22);
  doc.line(marginLeft + 25, boxY + 22, marginLeft + boxWidth - 10, boxY + 22);
  doc.setFontSize(11);
  doc.text("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:", marginLeft + 5, boxY + 32);

// üîπ ‡∏Ñ‡∏≥‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡πÅ‡∏ó‡∏£‡∏Å
doc.setFontSize(11);
doc.text("/", marginLeft + 38, boxY + 32);
doc.text("/", marginLeft + 53, boxY + 32);

// üîπ ‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á (‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏•‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏∂‡πà‡∏á)
doc.setLineWidth(0.2);

// üîπ ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏ô (‡∏•‡∏î‡∏à‡∏≤‡∏Å 8mm ‚Üí 6mm)
doc.line(marginLeft + 25, boxY + 33, marginLeft + boxWidth - 10, boxY + 33);


  // ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö
  const rightBoxX = marginLeft + boxWidth + boxSpacing;
  doc.rect(rightBoxX, boxY, boxWidth, boxHeight);
  doc.setFontSize(12);
  doc.text(`‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥`, rightBoxX + 5, boxY + 8);
  doc.setFontSize(11);
  doc.text("‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠", rightBoxX + 5, boxY + 22);
  doc.line(rightBoxX + 25, boxY + 22, rightBoxX + boxWidth - 10, boxY + 22);
  doc.setFontSize(11);
  doc.text("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:", rightBoxX + 5, boxY + 32);

  doc.text("/", rightBoxX + 38, boxY + 32);
  doc.text("/", rightBoxX + 53, boxY + 32);

  doc.setLineWidth(0.2);
  doc.line(rightBoxX + 25, boxY + 33, rightBoxX + boxWidth - 10, boxY + 33); // ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏ô


  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå
  const safeFileName = `‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô (${subject})`.replace(
    /[\/\\:*?"<>|]/g,
    "_"
  );
  doc.save(`${safeFileName}.pdf`);
};
